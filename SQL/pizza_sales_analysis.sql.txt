                                                         PIZZA SALES SQL QUERIES

CREATE TABLE pizza_orders (
    pizza_id INT PRIMARY KEY,
    order_id INT NOT NULL,
    pizza_name_id VARCHAR(50) NOT NULL,
    quantity INT NOT NULL,
    order_date DATE NOT NULL,
    order_time TIME NOT NULL,
    unit_price NUMERIC(10,2) NOT NULL,
    total_price NUMERIC(10,2) NOT NULL,
    pizza_size VARCHAR(5),
    pizza_category VARCHAR(50),
    pizza_ingredients TEXT,
    pizza_name VARCHAR(150)
);

SELECT * FROM pizza_orders;

COPY pizza_orders(
    pizza_id,
    order_id,
    pizza_name_id,
    quantity,
    order_date,
    order_time,
    unit_price,
    total_price,
    pizza_size,
    pizza_category,
    pizza_ingredients,
    pizza_name
)
FROM 'C:/Program Files/PostgreSQL/18/data/pizza_sales.csv'
DELIMITER ','
CSV HEADER;

SELECT * FROM pizza_orders;

A. KPIâ€™s

1. Total Revenue:
SELECT SUM(total_price) AS Total_Revenue FROM pizza_orders;

2. Average Order Value:
SELECT (SUM(total_price) / COUNT(DISTINCT order_id)) AS Avg_order_value FROM pizza_orders;

3. Total Pizzas Sold:
SELECT SUM(quantity) AS Total_pizza_sold FROM pizza_orders;

4. Total Orders:
SELECT COUNT(DISTINCT order_id) AS Total_orders FROM pizza_orders;

5. Average Pizzas Per Order:
SELECT CAST(CAST(SUM(quantity) AS DECIMAL(10,2)) / 
CAST(COUNT(DISTINCT order_id) AS DECIMAL(10,2)) AS DECIMAL(10,2))
AS Avg_Pizzas_per_order
FROM pizza_orders;


B. Daily Trend for Total Orders
SELECT TO_CHAR(order_date, 'DAY') AS order_day, COUNT(DISTINCT order_id) AS total_orders 
FROM pizza_orders
GROUP BY TO_CHAR(order_date, 'DAY');

C. Monthly Trend for Orders
SELECT 
    TO_CHAR(order_date, 'MONTH') AS Month_name, 
    COUNT(DISTINCT order_id) AS total_orders
FROM pizza_orders
GROUP BY 
    TO_CHAR(order_date, 'MONTH'),
    EXTRACT (MONTH FROM order_date)
ORDER BY  
    EXTRACT (MONTH FROM order_date);

D. % of Sales by Pizza Category
SELECT pizza_category, SUM(total_price)  AS total_revenue,
CAST(SUM(total_price) * 100 / (SELECT SUM(total_price) FROM pizza_orders) AS DECIMAL(10,2)) AS PCT
FROM pizza_orders
GROUP BY pizza_category;

E. % of Sales by Pizza Size
SELECT pizza_size, SUM(total_price) AS total_revenue,
CAST(SUM(TOTAL_PRICE) * 100 / (SELECT SUM(total_price) FROM pizza_orders) AS DECIMAL(10,2)) AS PCT
FROM pizza_orders
GROUP BY pizza_size
ORDER BY pizza_size;

F. Total Pizzas Sold by Pizza Category
SELECT pizza_category, SUM(quantity) as Total_Quantity_Sold
FROM pizza_orders
WHERE EXTRACT(MONTH FROM order_date) = 2
GROUP BY pizza_category
ORDER BY Total_Quantity_Sold DESC

G. Top 5 Pizzas by Revenue
SELECT pizza_name AS Top_5_pizza, SUM(total_price) AS Total_revenue
FROM pizza_orders
GROUP BY Top_5_pizza
ORDER BY Total_revenue DESC
LIMIT 5;

H. Bottom 5 Pizzas by Revenue
SELECT pizza_name AS bottom_5_pizza, SUM(total_price) AS Total_revenue
FROM pizza_orders
GROUP BY bottom_5_pizza
ORDER BY Total_revenue 
LIMIT 5;

I. Top 5 Pizzas by Quantity
SELECT pizza_name AS Top_5_pizza, SUM(quantity) AS Total_Pizza_Sold
FROM pizza_orders
GROUP BY Top_5_pizza
ORDER BY Total_Pizza_Sold DESC
LIMIT 5;

J. Bottom 5 Pizzas by Quantity
SELECT pizza_name AS Bottom_5_pizza, SUM(quantity) AS Total_Pizza_Sold
FROM pizza_orders
GROUP BY Bottom_5_pizza
ORDER BY Total_Pizza_Sold ASC
LIMIT 5;

K. Top 5 Pizzas by Total Orders
SELECT pizza_name AS Top_5_pizza, COUNT(DISTINCT order_id) AS Total_Orders
FROM pizza_orders
GROUP BY Top_5_pizza
ORDER BY Total_Orders DESC
LIMIT 5;

L. Borrom 5 Pizzas by Total Orders
SELECT pizza_name AS Bottom_5_pizza, COUNT(DISTINCT order_id) AS Total_Orders
FROM pizza_orders
GROUP BY Bottom_5_pizza
ORDER BY Total_Orders ASC
LIMIT 5;
